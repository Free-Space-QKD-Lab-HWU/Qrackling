%% script which outputs simulations to mimic the simulations in:
%Vulnerability of satellite quantum key distribution to disruption from ground-based lasers
%Gozzard, David R.
%Walsh, Shane
%Weinhold, Till

%% telescopes
TTel=Telescope(0.3,850,0.6,1.4465);
RTel=Telescope(0.3,850,0.6,1);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%100km separation
Distance_to_Jamming=100;                                                   %distance between receiver and jamming terminal in km
Earth_Radius=6371;                                                         %radius of earth in km
ArcDistance_to_jamming=(Distance_to_Jamming/Earth_Radius);
%% source
S=BB84_Source(850);

%% detect0r
D=BB84_Detector(850,1);

%% protocol
P=BB84_Protocol();

%% satellite pass
S=Satellite('500kmOrbitLLAT.txt',S,TTel);
S=SetFrontalArea(S,4);

%% Ground station
G=Ground_Station('ChilboltonWithHeadlights780nm.mat',D,RTel,'Receiver site',[51,0,20]);

%% jamming terminal
[JammingLat,JammingLon]=MoveAlongSurface(G.Latitude,G.Longitude,ArcDistance_to_jamming,90);
JammingLLA=[JammingLat,JammingLon,G.Altitude];
J=Jamming_Laser(850,0.1,JammingLLA,'Janice',1000,1);
J=SetPointingJitter(J,0);

%% passsimultion
PassNear=PassSimulation(S,P,G,J);
PassNear=Simulate(PassNear);
plot(PassNear);
drawnow;


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%1000km separation
Distance_to_Jamming=1000;                                                   %distance between receiver and jamming terminal in km
Earth_Radius=6371;                                                         %radius of earth in km
ArcDistance_to_jamming=(Distance_to_Jamming/Earth_Radius);
%% transmitter
S=BB84_Source(850);

%% receiver
D=BB84_Detector(850);

%% satellite pass
S=Satellite('500kmOrbitLLAT.txt',S,TTel);
S=SetFrontalArea(S,4);

%% Ground station
G=Ground_Station('ChilboltonWithHeadlights780nm.mat',D,RTel,'Receiver site',[51,0,0]);

%% jamming terminal
[JammingLat,JammingLon]=MoveAlongSurface(G.Latitude,G.Longitude,ArcDistance_to_jamming,90);
JammingLLA=[JammingLat,JammingLon,G.Altitude];
J=Jamming_Laser(850,0.1,JammingLLA,'Janice',1000,1);
J=SetPointingJitter(J,0);


%% passsimultion
PassFar=PassSimulation(S,P,G,J);
PassFar=Simulate(PassFar);
plot(PassFar);